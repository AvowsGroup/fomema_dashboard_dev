<!DOCTYPE html>
<html lang="en">
<head>
  <title>Fomema Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/stylenew.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/daterangepicker.css"/>
  <script type="text/javascript" src="/assets/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/moment.min.js"></script>
  <script type="text/javascript" src="/assets/daterangepicker.min.js"></script>
  <%= javascript_include_tag 'refresh', async: true %>
</head>
<body>
<div class="header">
  <nav class="navbar navbar-expand-md bg-light navbar-dark">
    <div class="admin-logo">
      <img src="../logo.png">
    </div>
    <!-- Topbar Search -->
    <div class="nav-title">
      <span>Dashboard </span>
      <h1>Department Information</h1>
    </div>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item dropdown">
        <div class="filter-content mx-0 px-0" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <div class="filter-li">
                <span>
                  <b>
                    <i class="fa fa-refresh" aria-hidden="true"></i>
                  </b> &nbsp;Refresh </span>
            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in m-0 p-0" aria-labelledby="userDropdown">
              <ul class="li-profile">
                <li  style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;"><a class="dropdown-item" id="refreshButton5"> 5 Min </a></li>
                <li  style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;"><a class="dropdown-item" id="refreshButton10">10 Min</a></li>
              </ul>
            </div>
          </div>
        </div>
      </li>
      <li class="nav-item dropdown mx-2">
        <a class="nav-link admin-name dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span>Dashboard</span>
        </a>
        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in m-0 p-0" aria-labelledby="userDropdown">
          <ul class="li-profile">
            <li style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;">
              <a class="dropdown-item" href="/first_dashboard/index">
                <i class="fa fa-dashboard mx-2"></i>Dashboard 1 </a>
            </li>
            <li style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;">
              <a class="dropdown-item" href="/second_dashboard/index">
                <i class="fa fa-dashboard mx-2"></i>Dashboard 2 </a>
            </li>
            <li style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;">
              <a class="dropdown-item" href="/dep_information/index">
                <i class="fa fa-dashboard mx-2"></i>Dashboard 3 </a>
            </li>
            <li style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;">
              <a class="dropdown-item" href="dashboard-4.html">
                <i class="fa fa-dashboard mx-2"></i>Dashboard 4 </a>
            </li>
            <li style="border-bottom: dotted 1px #c2c2c2; font-size: 12px;">
              <a class="dropdown-item" href="dashboard-5.html">
                <i class="fa fa-dashboard mx-2"></i>Dashboard 5 </a>
            </li>
          </ul>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link admin-name dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span>Admin </span>
          <img class="img-profile rounded-circle" src="/assets/undraw_profile.svg">
        </a>
        <!-- Dropdown - User Information -->
        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in m-0 p-0" aria-labelledby="userDropdown">
          <ul class="li-profile">
            <li class="dropdown-item">
              <a href="#">
                <i class="fa fa-sign-out fa-sm"></i> Logout </a>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </nav>
</div>
<div class="filter-div">
  <ul class="filter mobile-filter mb-0">
    <li>
      <div class="month-filter">
        <div class="form-group">
          <div class="input-group">
            <div class="input-group-append">
                  <span class="input-group-text">
                    <i class="fa fa-calendar-plus-o"></i>
                  </span>
            </div>
            <select id="month" class="form-control" aria-label="Filter select">
              <option value="Select Monthly"> Select Monthly</option>
              <option value="January">January</option>
              <option value="February">February</option>
              <option value="March">March</option>
              <option value="April">April</option>
              <option value="May">May</option>
              <option value="June">June</option>
              <option value="July">July</option>
              <option value="August">August</option>
              <option value="September">September</option>
              <option value="October">October</option>
              <option value="November">November</option>
              <option value="December">December</option>
            </select>
          </div>
        </div>
      </div>
    </li>
    <li class="mx-0">
      <div class="month-filter">
        <div class="form-group">
          <div class="input-group input-daterange">
            <div class="input-group-append">
                  <span class="input-group-text">
                    <i class="fa fa-calendar"></i>
                  </span>
            </div>
            <input type="text" class="form-control" name="daterange" value="01/01/2018 - 01/15/2018">
          </div>
        </div>
      </div>
      <script>
          $(function () {
              $('.datepicker').datepicker({
                  language: "es",
                  autoclose: true,
                  format: "dd/mm/yyyy"
              });

          });
      </script>
      <script>
          $(document).ready(function () {
              $(function () {
                  $('input[name="daterange"]').daterangepicker({
                      "startDate": "18/08/2023",
                      "endDate": "28/08/2023",
                      opens: 'center',
                      locale: {
                          format: 'DD/MM/YYYY'
                      }
                  });
              });
          });
          $(document).ready(function () {
              $(".dropdown-toggle").click(function () {
                  $(".caret").toggleClass('rotate-180');
              });
          });
      </script>
    </li>
    <li>
      <div class="month-filter ">
        <div class="filter-btn" style="margin-top: 5px;">
          <button class="btn-apply" onclick="filter_kpi(true)">Apply</button>
          <button id="clear-button" class="btn-clear" onclick="cancel_filter()">Clear</button>
        </div>
      </div>
    </li>
  </ul>
</div>
<div id="filter_cards"><%= render 'card_details' %> </div>
</div>
</div>
</body>
</html>
<script>
    function filter_date(boolean) {
        const selectedWeek = $('#week').val();
        const dateRange = $('input[name="daterange"]').val();
        const selectedMonth = $('#month').val();


        const formData = {
            week: selectedWeek,
            dateRange: dateRange,
            month: selectedMonth,
            boolean: boolean
        };

        const data = JSON.stringify(formData);

        const url = '/dashboards/dep_information/third_db_data.js';


        $.ajax({
            url: url,
            type: "GET",
            data: data,
            success: function (response) {
            },
            error: function (xhr, status, error) {
                // Handle error
            }
        });
    }

    function cancel_filter() {

        const url = '/dashboards/dep_information/index.js';

        $.ajax({
            url: url,
            type: "GET",
            data: ""
        })
    }

</script>



<script>
    // Add a variable to track the active state
    var controlsActive = true;

    $(document).ready(function () {
        // Function to update the date range based on month and week selection
        function updateDateRange(month) {
            if (month && controlsActive) {
                var year = new Date().getFullYear();
                var startDate = moment(year + "-" + month + "-" + 1, "YYYY-MMM-D");
                // Calculate the last day of the month
                var endDate = moment(startDate).endOf('month');

                // Update the date range input
                $('input[name="daterange"]').data('daterangepicker').setStartDate(startDate);
                $('input[name="daterange"]').data('daterangepicker').setEndDate(endDate);

                // Disable the date range input and set it to read-only
                $('input[name="daterange"]').prop('disabled', true);
            }
        }

        // Event handler for month dropdown change
        $('#month').change(function () {
            var selectedMonth = $('#month').val();

            if (controlsActive) {
                updateDateRange(selectedMonth);
            }
        });

        // Event handler for date range input changes
        $('input[name="daterange"]').on('apply.daterangepicker', function (ev, picker) {
            // Extract the selected dates
            var startDate = picker.startDate;
            var endDate = picker.endDate;

            // Determine the corresponding month
            var month = startDate.format('MMMM');

            // Update the month dropdown
            $('#month').val(month).trigger('change');

            // Disable the dropdown
            $('#month').prop('disabled', true);
            controlsActive = true; // Re-enable dropdown

            // Enable the date range input
            $('input[name="daterange"]').prop('disabled', false);
        });

        // Event handler for the "Clear" button
        $('#clear-button').click(function () {
            resetFilterControls();
        });

        function resetFilterControls() {
            // Reset month dropdown to its default value
            $('#month').val('Select Monthly');

            // Reset the date range input to its default value
            $('input[name="daterange"]').data('daterangepicker').setStartDate("18/08/2023");
            $('input[name="daterange"]').data('daterangepicker').setEndDate("28/08/2023");

            // Enable the control
            $('#month').prop('disabled', false);
            $('input[name="daterange"]').prop('disabled', false);
            controlsActive = true; // Re-enable control
        }

    });

</script>


<script>
    function filter_kpi(boolean) {
        const dateRange = $('input[name="daterange"]').val();
        const selectedMonth = $('#month').val();

        const formData = {
            dateRange: dateRange,
            month: selectedMonth,
            boolean: boolean
        };

        const url = '/dashboards/dep_information/filter_kpi';

        $.ajax({
            url: url,
            type: "GET",
            data: formData,
            success: function (response) {
                const managementOfSpAverage = response.management_of_sp_average;
                const humanCapitalAverage = response.human_capital_average;
                const inpectorateAverage = response.inpectorate_average;
                const xrayQcc = response.xray_qcc;
                const medicalReviewAppeal = response.medical_review_appeal;
                const financeAdm = response.finance_adm;
                const regionalOfficeAvgKpi = response.regional_office_avg_kpi;
                const customerService = response.customer_service;
                const lqcc = response.lqcc;
                const supportServiceAvgKpi = response.suppor_service_avg_kpi;

                // Now you can use these values as needed
                console.log("Management of SP Average:", managementOfSpAverage);
                console.log("Human Capital Average:", humanCapitalAverage);
                console.log("Inpectorate Average:", inpectorateAverage);
                console.log("Xray QCC:", xrayQcc);
                console.log("Medical Review Appeal:", medicalReviewAppeal);
                console.log("Finance ADM:", financeAdm);
                console.log("Regional Office Avg KPI:", regionalOfficeAvgKpi);
                console.log("Customer Service:", customerService);
                console.log("LQCC:", lqcc);
                console.log("Support Service Avg KPI:", supportServiceAvgKpi);

                $('.progress-value-management').text(managementOfSpAverage);
                $('.progress-value-hcm').text(humanCapitalAverage);
                $('.progress-value-inspectorate').text(inpectorateAverage);
                $('.progress-value-xrayqcc').text(xrayQcc);
                $('.progress-value-mra').text(medicalReviewAppeal);
                $('.progress-value-finance').text(financeAdm);
                $('.progress-value-regional').text(regionalOfficeAvgKpi);
                $('.progress-value-css').text(customerService);
                $('.progress-value-lqcc').text(lqcc);
                $('.progress-value-support').text(supportServiceAvgKpi);

            },
            error: function (xhr, status, error) {
                // Handle error
            }
        });
    }

    // Call filter_kpi on apply button click
    $('.btn-apply').on('click', function () {
        filter_kpi(true);
    });
</script>